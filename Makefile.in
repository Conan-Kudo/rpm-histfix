SUBDIRS = lib
OBJS = spec.o build.o pack.o query.o
PROGS = rpm rpmlead rpmheader rpmarchive rpmbuild

WARNINGS = -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes 
DEBUG = -g
OPTS = -O2
CFLAGS = $(WARNINGS) $(DEBUG) $(OPTS) -Ilib
LDFLAGS = $(DEBUG) -Llib 
LOADLIBES = -lrpm -ldb -lefence

all: make-subdirs $(OBJS) $(PROGS)
	
make-subdirs:
	for d in $(SUBDIRS); do \
		(cd $$d; $(MAKE)) ;\
	done

rpm: rpm.o $(OBJS) lib/librpm.a
rpmbuild: rpmbuild.o $(OBJS) lib/librpm.a

clean:
	for d in $(SUBDIRS); do \
		(cd $$d; $(MAKE) $@) ;\
	done
	rm -f *.o *~ $(PROGS)

depend:
	$(CPP) $(CFLAGS) -M *.c > .depend
	for d in $(SUBDIRS); do \
		(cd $$d; $(MAKE) $@) ;\
	done

ifeq (.depend,$(wildcard .depend))
include .depend
endif
